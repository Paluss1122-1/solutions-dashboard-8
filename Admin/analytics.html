<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Website-Analytics</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
      background-color: gray;
    }
    h1 { font-size: 2rem; margin-bottom: 1rem; }
    .stat { background: rgb(234, 234, 234); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    .visit-entry { border-top: 1px solid #eee; padding-top: 0.5rem; margin-top: 0.5rem; border-bottom: 1px gray solid; }
    .access-denied {
      text-align: center;
      padding: 50px;
      background: #f8d7da;
      color: #721c24;
      border-radius: 10px;
      margin: 20px;
      border: 1px solid #f5c6cb;
    }
    .access-denied h1 { color: #721c24; margin-bottom: 20px; }
  </style>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // Zugangskontrolle
    function checkAccess() {
      const username = localStorage.getItem('username');
      if (username !== 'Paluss1122') {
        document.body.innerHTML = `
          <div class="access-denied">
            <h1>ğŸš« Zugang verweigert</h1>
            <p>Du hast keine Berechtigung, diese Seite zu besuchen.</p>
            <p>Aktueller Benutzer: ${username || 'Nicht angemeldet'}</p>
          </div>
        `;
        return false;
      }
      return true;
    }

    // Supabase Config
    const supabaseUrl = "https://empsgwnjxxhzyudvxyxg.supabase.co";
    const supabaseKey = "sb_publishable_aTwBvGnNtosusrlawR6rHQ_anwwpfR6";
    const supabase = createClient(supabaseUrl, supabaseKey);

    async function ladeAnalytics() {
      const container = document.getElementById("besuche");
      container.innerHTML = "<p>Lade Analytics-Daten...</p>";

      try {
        const { data, error } = await supabase
          .from("analytics")
          .select("*")
          .order("datum", { ascending: false }); // ACHTUNG: Spaltenname prÃ¼fen!

        if (error) {
          console.error("Supabase Fehler:", error);
          container.innerHTML = `<p>Fehler beim Laden: ${error.message}</p>`;
          return;
        }

        if (!data || data.length === 0) {
          container.innerHTML = "<p>Keine Analytics-EintrÃ¤ge gefunden.</p>";
          return;
        }

        container.innerHTML = "";
        data.forEach(entry => {
          const div = document.createElement("div");
          div.className = "visit-entry";
          div.innerHTML = `
            <p><strong>ID:</strong> ${entry.id || "-"}</p>
            <p>ğŸ•“ Zeit: ${entry.zeit || entry.datum || "-"}</p>
            <p>ğŸ§­ Browser: ${entry.browser || "-"}</p>
            <p>ğŸ“± GerÃ¤t: ${entry.device || "-"}</p>
            <p>ğŸŒ Website: ${entry.link || "-"}</p>
            <p>ğŸ‘¤ Person: ${entry.name || "-"}</p>
            <p>âš¡ Aktion: ${entry.action || entry.Action || "-"}</p>
          `;
          container.appendChild(div);
        });

      } catch (e) {
        console.error("JS Fehler:", e);
        container.innerHTML = `<p>Fehler beim Laden der Daten: ${e.message}</p>`;
      }
    }

    window.addEventListener("DOMContentLoaded", () => {
      if (checkAccess()) {
        ladeAnalytics();
      }
    });
  </script>
</head>
<body>
  <h1>ğŸ“Š Analytics-EintrÃ¤ge</h1>
  <div class="stat">
    <h2>Letzte Besuche (Supabase)</h2>
    <div id="besuche"></div>
  </div>
</body>
</html>
