<!DOCTYPE html>
<html lang='de'>

<head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>Dashboard</title>
    <link rel='icon' href='favicon.ico' />
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
        }

        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            background: linear-gradient(-45deg, black, gray);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            overflow: hidden;
            background-repeat: no-repeat;
        }

        #login-container {
            top: 50%;
            position: fixed;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            background: #272727;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin: 0;
            transition: opacity 1s;
            text-align: center;
        }

        #dashboard {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #2d2d2d;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: opacity 1s;
            text-align: center;
        }

        #login-container h2 {
            margin-bottom: 20px;
            margin-top: 0;
            color: white;
            font-size: 30px;
            animation: colorchange 2s ease-in-out;
            transition: all 0.5s;
        }

        #login-container label {
            color: white;
            display: block;
            margin: 10px 0 5px;
            font-size: 20px;
        }

        #login-container input {
            width: 100%;
            padding: 10px 0px;
            margin-bottom: 15px;
            border: none;
            border-radius: 20px;
            background-color: #000000;
            color: white;
            text-decoration: double;
            font-size: 20px;
            transition: border-color 0.3s;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        #login-container input:focus {
            border-color: #1a1a1a;
            outline: none;
        }

        #login-container button {
            padding: 10px 15px;
            background-color: #808080;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 5px;
        }

        #login-container button:hover {
            background-color: #515050;
        }

        #info-container {
            position: fixed;
            width: 99%;
            height: 99%;
            top: 0;
            left: 0;
            padding: 20px 0px;
            background: #272727;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            color: white;
            font-size: 3em;
            transition: opacity 0.3s;
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        #info-container * {
            width: 100%;
            margin: 10px;
        }

        #info-container button {
            width: 100%;
            min-width: 100px;
            border: none;
            border-radius: 30px;
            background-color: gray;
            padding: 20px 40px;
            cursor: pointer;
            color: white;
            font-size: 30px;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        #Hinweis-1 {
            color: red;
            font-size: 20px;
            margin: 0;
            margin-bottom: 5px;
            text-align: center;
        }

        #Hinweis-2 {
            color: red;
            font-size: 20px;
            margin: 0;
            margin-bottom: 5px;
            text-align: center;
        }

        #Hinweis-3 {
            color: green;
            font-size: 20px;
            margin: 0;
            margin-bottom: 5px;
            text-align: center;
        }

        #start {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 50px;
            z-index: 10000;
            margin: 0;
            transition: opacity 3s;
            opacity: 0;
            text-align: center;
            text-align: center;
        }

        #login-form-3 button {
            margin: 10px 5px 10px 5px;
            font-size: 20px;
        }

        .selected {
            border: 5px solid #0033ff !important;
        }

        .notselected {
            border: none;
        }

        #black {
            position: fixed;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: -1000000000;
            display: none;
            opacity: 0;
            transition: opacity 1s;
        }

        .intro-title {
            margin: 0;
            font-size: 4.5em;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            margin-bottom: 10px;
            transform: scale(3);
            opacity: 0.3;
            transition: transform 2s ease-in-out, opacity 3s;
            text-align: center;
            background: linear-gradient(150deg, red, blue);
            color: transparent;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .intro-credits {
            margin: 0;
            font-size: 2em;
            opacity: 0;
            transition: opacity 1s;
            text-align: center;
            background: red;
            color: transparent;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #intro {
            position: fixed;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: black;
            z-index: 10000000000000000000;
        }

        .link-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            align-items: center;
        }

        .link-container a {
            color: white;
            text-decoration: none;
            background-color: rgb(105, 105, 105);
            padding: 10px 15px;
            border-radius: 5px;
            text-align: center;
            transition: background-color 0.3s;
            width: 50%;
            transition: transform 2s, background-color 2s;
            position: relative;
            opacity: 0;
            transform: translateY(-20px);
            animation: fadeIn 2s ease-out forwards;
        }

        .link-container h3 {
            margin: 0;
            padding: 10px;
            background-color: #181818;
            border-radius: 5px;
            width: 50%;
            text-align: center;
            cursor: default;
            animation: h3 1.5s ease-out forwards;
            opacity: 0;
            color: white;
        }

        .link-container a:hover {
            background-color: #808080;
            transform: scale(1.05);
        }

        .link-container a::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #3e3e3e;
            border-radius: 5px;
            z-index: 0;
            opacity: 0;
            animation: showBackground 3s ease-out forwards;
        }

        .link-container a span {
            position: relative;
            z-index: 1;
        }

        @keyframes h3 {
            0% {
                opacity: 0;
                transform: translateY(-20px);
                background-color: #8d8d8d;
            }

            100% {
                opacity: 1;
                transform: translateY(0);
                background: none;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes showBackground {
            0% {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        @keyframes colorchange {
            0% {
                color: white;
            }

            50% {
                color: black;
            }

            100% {
                color: white;
            }
        }



        .settings {
            width: 100px;
            bottom: 0;
            left: 0;
            position: fixed;
            cursor: pointer;
            height: 100px;
            background: none;
            border: none;
            transition: all 1s;
            transform-origin: 100% 100%;
            image-rendering: optimizeQuality;
        }

        .shopimg {
            top: 0;
            left: 0;
            height: 100%;
            position: fixed;
        }

        .settingsframe {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: gray;
            top: 0;
            display: none;
            transition: all 0.5s, opacity 1s;
            justify-items: center;
            margin: 0;
            top: 0;
            overflow-y: auto;
            border-radius: 0px;
        }

        .offer {
            text-align: center;
            margin-top: 10px;
            background-color: #000000;
            border-radius: 20px;
            color: white;
            z-index: 100;
            padding: 20px;
        }

        .offer button {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            font-size: 20px;
            margin: 10px;
            background-color: #808080;
            color: white;
            border-radius: 50px;
            padding: 20px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .offer button:hover {
            background-color: #515050;
            transform: scale(1.1);
        }

        .green-arrow {
            position: absolute;
            height: 100%;
            transition: all 0.5s;
            bottom: 0;
            position: fixed;
            background: none;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 2s;
            height: 10%;
            right: 0;
        }

        #bg-setting button {
            margin: 10px 5px 10px 5px;
            font-size: 20px;
        }

        #setdisplayname {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #setdisplayname input {
            width: 100%;
            max-width: 400px;
            border-radius: 30px;
            background-color: gray;
            border: none;
            padding: 10px 20px;
            text-align: center;
            color: white;
            font-size: 20px;
            margin-top: 5px;
        }

        #setdisplayname input:focus {
            outline: none;
        }
    </style>
</head>

<body>
    <div id='intro'>
        <p class='intro-title' style='transform: scale(2.5); position: fixed; top: 0; transform-origin: 50% 0%;'>Hi
            <span style='color: red;' id='intro-username'></span>
        </p>
        <p class='intro-title'>Solutions Dashboard 8</p>
        <p class='intro-credits'>Made by Paluss1122</p>
    </div>

    <script>
        function start() {
            const title = document.getElementsByClassName('intro-title')[0];
            const credits = document.getElementsByClassName('intro-credits')[0];
            const credits2 = document.getElementsByClassName('intro-title')[1];
            if (!localStorage.getItem('username')) {
                title.style.display = 'none'
            } else {
                const introUser = localStorage.getItem('username');
                const introUsernameElement = document.getElementById('intro-username');
                if (introUser && introUsernameElement) {
                    introUsernameElement.innerText = introUser;
                } else if (introUsernameElement) {
                    introUsernameElement.innerText = '';
                }
            }
            setTimeout(() => {
                title.style.transform = 'scale(1)';
                credits2.style.transform = 'scale(1)';
                title.style.opacity = '1';
                credits2.style.opacity = '1';
                setTimeout(() => {
                    credits.style.opacity = '1'
                }, 1000);
            }, 10);
        }

        start()
    </script>
    <div id='black' style='opacity: 0; display: none;'></div>
    <iframe id='bg-iframe' src='LoadingScreen/Spinning circle/index.html' frameborder='0'
        style='width: 100%; height: 100%; position: fixed; top: 0; z-index: -100000; transform: scale(5); opacity: 1; filter: saturate(0); transition: filter 2s;'></iframe>
    <p id='start'>Beginnen wir!</p>
    <div id='info-container' style='opacity: 0; z-index: -10;'>
        <p id='info-title' style='font-size: 0.8em; text-decoration: underline;'>Hiiii</p>
        <p id='info-text' style='font-size: 0.5em'>Hiiii</p>
        <button
            onclick='document.getElementById("info-container").style.opacity = "0"; setTimeout(() => {document.getElementById("info-container").style.zIndex = "-10";}, 500);'>Zurück</button>
    </div>
    <div id='login-container' style='display: none; opacity: 0;'>
        <form id='login-form-1'>
            <label for='username' style='margin-top: 0;'>Gib deinen Nutzername ein:</label>
            <input type='text' id='username' required autocomplete='on' style='text-align: center' />
            <p id='Hinweis-1' style='display: none;'></p>
            <button style='margin: 0;' type='submit'>Weiter zur Passwort Eingabe</button>
            <button onclick='nousername()' type='button'>Ich kenne meinen Nutzername nicht / <br> Ich hab keinen
                Nutzername erhalten</button>
        </form>
        <form id='login-form-2' style='display: none;'>
            <label for='password' style='margin-top: 0;'>Gib dein Passwort ein:</label>
            <input style='text-align: center' type='text' id='password' required />
            <p id='Hinweis-2' style='display: none;'></p>
            <button id='eye' type='button' onclick='togglePasswordVisibility()'
                style='position: absolute; right: 10px; top: 50%; transform: translateY(-70%); background: none; border: none; cursor: pointer; padding: 0; margin: 0; display: none; font-size: 30px;'>
                👁️
            </button>
            <button style='margin: 0;' type='submit'>Anmelden</button><br>
            <button onclick='nopassword()' type='button'>Ich kenne mein Passwort nicht / <br> Ich hab kein
                Passwort erhalten</button>
            <br>
            <button type='button'
                onclick='document.getElementById("login-container").style.transition = "opacity 0.5s"; document.getElementById("login-container").style.opacity = "0"; setTimeout(() => { document.getElementById("login-form-2").style.display = "none"; document.getElementById("login-form-1").style.display = "block"; document.getElementById("login-container").style.opacity = "1";}, 500);'>Zurück</button>
        </form>
        <form id='login-form-3' style='display: none;'>
            <label for='password' style='margin-top: 0;'>Welchen Hintergrund möchtest du haben?
            </label>

            <div>
                <button type='button' id='spinningbg' class='selected' style='background: gray; color: black;'
                    onclick='changebg("spinning")'>
                    Drehender Kreis
                </button>

                <button type='button' id='wavebg' class='notselected' style='background: gray; color: black;'
                    onclick='changebg("wave")'>
                    Welle
                </button>

                <button type='button' id='rainbg' class='notselected' style='background: gray; color: black;'
                    onclick='changebg("rain")'>
                    Regen
                </button>

                <button type='button' id='slidebg' class='notselected' style='background: gray; color: black;'
                    onclick='changebg("slide")'>
                    Slidende Diagonalen
                </button>

                <button type='button' id='blackbg' class='notselected'
                    style='background: linear-gradient(to right, rgb(17, 17, 17), gray)' onclick='changebg("black")'>
                    Schwarz - Grau
                </button>
                <button type='button' id='bluebg' class='notselected'
                    style='background: linear-gradient(to right, blue, red)' onclick='changebg("blue")'>
                    Blau - Rot
                </button>
                <button type='button' id='greenbg' class='notselected'
                    style='background: linear-gradient(to right, Green, Yellow); color: black;'
                    onclick='changebg("green")'>
                    Grün - Gelb
                </button>
                <button type='button' id='redbg' class='notselected'
                    style='background: linear-gradient(to right, red, orange); color: black;' onclick='changebg("red")'>
                    Rot - Orange
                </button>

                <button type='button' id='lilabg' class='notselected'
                    style='background: linear-gradient(to right, purple, blue); color: white;'
                    onclick='changebg("lila")'>
                    Lila - Blau
                </button>

                <button type='button' id='bluegreenbg' class='notselected'
                    style='background: linear-gradient(to right, blue, green); color: white;'
                    onclick='changebg("bluegreen")'>
                    Blau - Grün
                </button>

                <button type='button' id='greenredbg' class='notselected'
                    style='background: linear-gradient(to right, green, red); color: white;'
                    onclick='changebg("greenred")'>
                    Grün - Rot
                </button>
            </div>

            <button style='margin: 0;' type='submit'>Speichern</button>
            <br>
            <button type='button'
                onclick='document.getElementById("login-container").style.transition = "opacity 0.5s"; document.getElementById("login-container").style.opacity = "0"; setTimeout(() => { document.getElementById("login-form-3").style.display = "none"; document.getElementById("login-form-2").style.display = "block"; document.getElementById("login-container").style.opacity = "1";}, 500);'>Zurück</button>
        </form>
        <form id='login-form-4' style='display: none;'>
            <label for='password' style='margin-top: 0;'>Wie möchtest du genannt werden?</label>
            <input style='text-align: center' type='text' id='displayname' required />
            <button style='margin: 0;' type='submit'>Speichern</button>

            <br>
            <button type='button'
                onclick='document.getElementById("login-container").style.transition = "opacity 0.5s"; document.getElementById("login-container").style.opacity = "0"; setTimeout(() => { document.getElementById("login-form-4").style.display = "none"; document.getElementById("login-form-3").style.display = "block"; document.getElementById("login-container").style.opacity = "1";}, 500);'>Zurück</button>
        </form>
        <form id='login-form-5' style='display: none;'>
            <label for='password' style='margin-top: 0;'>Erlaubst du die Speicherung von Einstellungen? (sonst jedes Mal
                neu anmelden)</label>

            <button type='submit' style='background-color: green;'>Ja ich erlaube die Verwendung von Cookies
                (Speicherung)</button>
            <button type='button' onclick='localStorage.clear(); window.location.reload()'
                style='background-color: red;'>Nein ich erlaube die Verwendung von Cookies (Speicherung) nicht
                <u>(Website nicht nutzbar)</u></button>
            <br>
            <button type='button'
                onclick='document.getElementById("login-container").style.transition = "opacity 0.5s"; document.getElementById("login-container").style.opacity = "0"; setTimeout(() => { document.getElementById("login-form-5").style.display = "none"; document.getElementById("login-form-4").style.display = "block"; document.getElementById("login-container").style.opacity = "1";}, 500);'>Zurück</button>
        </form>
    </div>
    <div id='dashboard' style='display: none; opacity: 0;'>
        <h1 style='animation: colorchange 2s ease-in-out; color: white;'>
            <span id='Begrüßung'></span> <span id='usname'></span><span id='f'></span>
        </h1>
        <div class='link-container' id='link-container'>
            <h3 id='maths'><u>Mathe Lösungen</u></h3>
            <a href=' ' id='device-infos'><span>Alle Lösungen</span></a>
            <h3 id='device-infos-text'><u>Geräte Informationen</u></h3>
            <a href='https://device-information-paluss1122.netlify.app' id='device-infos'><span>Geräte Infos</span></a>
            <h3 id='games-website-text'><u>Spiele</u></h3>
            <a href='https://games-paluss1122.netlify.app/' id='games-website'><span>Spiele</span></a>
        </div>
    </div>
    <button class='settings' onclick='settings()' id='shopbt' style='transform: scale(1); display: none;'>
        <img src='settings.png' class='shopimg' alt='settings image' />
    </button>
    <div id='settingsframe' style='display: none; opacity: 0;' class='settingsframe'>
        <div class='offer' style='border-radius: 50px 50px 0px 0px'>
            <h4 style='margin: 0; font-size: 30px'><u>Hintergrund</u></h4>
            <div class='offer' style='margin: 0; padding-bottom: 0'>
                <form id='bg-setting' style='display: block;'>
                    <label for='password' style='margin-top: 0;'>Welchen Hintergrund möchtest du haben? <span
                            style='color: gray;'>(Kann später in den Einstellungen nochmal geändert werden)</span>
                    </label>

                    <div>
                        <button type='button' id='spinningbg' class='selected' style='background: gray; color: black;'
                            onclick='changebg("spinning")'>
                            Drehender Kreis
                        </button>

                        <button type='button' id='wavebg' class='notselected' style='background: gray; color: black;'
                            onclick='changebg("wave")'>
                            Welle
                        </button>

                        <button type='button' id='rainbg' class='notselected' style='background: gray; color: black;'
                            onclick='changebg("rain")'>
                            Regen
                        </button>

                        <button type='button' id='slidebg' class='notselected' style='background: gray; color: black;'
                            onclick='changebg("slide")'>
                            Slidende Diagonalen
                        </button>

                        <button type='button' id='blackbg' class='notselected'
                            style='background: linear-gradient(to right, rgb(17, 17, 17), gray)'
                            onclick='changebg("black")'>
                            Schwarz - Grau
                        </button>
                        <button type='button' id='bluebg' class='notselected'
                            style='background: linear-gradient(to right, blue, red)' onclick='changebg("blue")'>
                            Blau - Rot
                        </button>
                        <button type='button' id='greenbg' class='notselected'
                            style='background: linear-gradient(to right, Green, Yellow); color: black;'
                            onclick='changebg("green")'>
                            Grün - Gelb
                        </button>
                        <button type='button' id='redbg' class='notselected'
                            style='background: linear-gradient(to right, red, orange); color: black;'
                            onclick='changebg("red")'>
                            Rot - Orange
                        </button>

                        <button type='button' id='lilabg' class='notselected'
                            style='background: linear-gradient(to right, purple, blue); color: white;'
                            onclick='changebg("lila")'>
                            Lila - Blau
                        </button>

                        <button type='button' id='bluegreenbg' class='notselected'
                            style='background: linear-gradient(to right, blue, green); color: white;'
                            onclick='changebg("bluegreen")'>
                            Blau - Grün
                        </button>

                        <button type='button' id='greenredbg' class='notselected'
                            style='background: linear-gradient(to right, green, red); color: white;'
                            onclick='changebg("greenred")'>
                            Grün - Rot
                        </button>
                    </div>
                </form>
                <form id='setdisplayname'>
                    <label for='set-displayname'>Wie möchtest du genannt werden?</label>
                    <input type='text' id='set-displayname'>
                    <p id='Hinweis-3'></p>
                    <button onmouseenter='this.style.transform = "scale(1)"' style='border: none;'
                        type='submit'>Speichern</button>
                </form>
                <br>
                <button onclick='localStorage.clear(); window.location.reload()' style='margin-bottom: 50px'>
                    Fehlerbehebung mit Einstellungen + Abmeldung + Einstellungen werden
                    zurückgesetzt
                </button>
            </div>
        </div>
        <button id='closebtshop' onclick='settings()' style='
      bottom: 0;
      position: fixed;
      background: none;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      height: 10%;
      right: 0;
      width: 87px;
      z-index: 100000000000;
    '>
            <img src='green-arrow.webp' alt='' class='green-arrow' style='z-index: 100000000000' />
        </button>
    </div>
    <script type='module'>
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // Supabase-Initialisierung (ersetze durch deine eigenen Supabase-URL und API-Key)
        const SUPABASE_URL = 'https://empsgwnjxxhzyudvxyxg.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVtcHNnd25qeHhoenl1ZHZ4eXhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3MTI2NzUsImV4cCI6MjA2OTI4ODY3NX0.WvGmXzoIojeiM8l1GN_e9iRq5C5G2AURiyy96NLjnhE';

        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // Nutzer aus Supabase laden
        let users = [];

        async function ladeUsers() {
            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('username, password, displayname, allowedcookies, bgcolor');

                if (error) {
                    console.error('Fehler beim Laden der Nutzer:', error.message);
                    return;
                }

                users = data || [];
                console.log('Geladene Nutzer:', users);
                window.users = users;
            } catch (err) {
                console.error('Unerwarteter Fehler:', err);
            }
        }

        // Lade die Nutzer beim Start
        ladeUsers();
        // Fallback: Wenn nach 5 Sekunden keine Nutzer geladen sind, trotzdem starten
        setTimeout(() => {
            start();
        }, 2000);


        async function nutzerdatenAendern(username, neueDaten) {
            try {
                // Nutzer in Supabase updaten
                const { data, error } = await supabase
                    .from('users')
                    .update(neueDaten)
                    .eq('username', username);

                if (error) {
                    console.error('Fehler beim Aktualisieren der Nutzerdaten:', error.message);
                    return false;
                }

                // Auch im lokalen users-Array aktualisieren
                users = users.map(user => {
                    if (user.username === username) {
                        return { ...user, ...neueDaten };
                    }
                    return user;
                });

                // Wenn der aktuell eingeloggte Nutzer geändert wurde, founduser aktualisieren
                if (founduser && founduser.username === username) {
                    founduser = { ...founduser, ...neueDaten };
                }

                console.log('Nutzerdaten erfolgreich aktualisiert:', data);
                return true;
            } catch (err) {
                console.error('Unerwarteter Fehler beim Ändern der Nutzerdaten:', err);
                return false;
            }
        }

        // Funktion global verfügbar machen
        window.nutzerdatenAendern = nutzerdatenAendern;


        // Hilfsfunktionen für Browser-Erkennung
        function getBrowserName() {
            const userAgent = navigator.userAgent;

            if (userAgent.includes('Firefox')) return 'Firefox';
            if (userAgent.includes('Chrome')) return 'Chrome';
            if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) return 'Safari';
            if (userAgent.includes('Edge')) return 'Edge';
            if (userAgent.includes('Opera')) return 'Opera';
            if (userAgent.includes('Trident')) return 'Internet Explorer';

            return 'Unknown';
        }

        window.SendAnalyticsStep = async function (action) {
            let user = null;
            window.console.log(action);
            try {
                user = window.founduser.username;
            } catch (e) {
                console.error("Fehler beim Auslesen des Benutzernamens:", e);
                user = null;
            }

            // Prüfe, ob die Seite nicht lokal läuft
            const isLocal = window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost";
            if (!isLocal) {
                try {
                    const { error } = await supabase.from('analytics').insert([{
                        browser: getBrowserName(),
                        device: (navigator.userAgentData && navigator.userAgentData.platform) || navigator.userAgent,
                        datum: new Date().toISOString(),
                        link: window.location.href,
                        username: user,
                        Action: action
                    }]);
                    if (error) {
                        await supabase.from('Fehlerberichte').insert([{
                            userAgent: (navigator.userAgentData && navigator.userAgentData.platform) || navigator.userAgent,
                            zeit: new Date().toISOString(),
                            fehler: error.message || error
                        }]);
                    }
                } catch (err) {
                    await supabase.from('Fehlerberichte').insert([{
                        userAgent: (navigator.userAgentData && navigator.userAgentData.platform) || navigator.userAgent,
                        zeit: new Date().toISOString(),
                        fehler: err.message || err
                    }]);
                }
            }
        }
    </script>

    <script>
        const loginform1 = document.getElementById('login-form-1');
        const loginform2 = document.getElementById('login-form-2');
        const loginform3 = document.getElementById('login-form-3');
        const loginform4 = document.getElementById('login-form-4');
        const loginform5 = document.getElementById('login-form-5');
        const loginContainer = document.getElementById('login-container');
        const linkcontainer = document.getElementById('link-container');
        const settingsframe = document.getElementById('settingsframe');
        let founduser = null;
        const Hinweis1 = document.getElementById('Hinweis-1');
        const Hinweis2 = document.getElementById('Hinweis-2');
        const Hinweis3 = document.getElementById('Hinweis-3');
        const black = document.getElementById('black');
        const bgsetting = document.getElementById('bg-setting');
        const intro = document.getElementById('intro');
        const startp = document.getElementById('start');
        const begruessung = document.getElementById('Begrüßung');
        const setdisplayname = document.getElementById('set-displayname');
        const f = document.getElementById('f');
        const dashboard = document.getElementById('dashboard');
        const bgiframe = document.getElementById('bg-iframe');
        const usname = document.getElementById('usname')
        const infocontainer = document.getElementById('info-container')
        const infotitle = document.getElementById('info-title');
        const infotext = document.getElementById('info-text');
        const username = document.getElementById('username');
        const password = document.getElementById('password');
        const displayname = document.getElementById('displayname');

        function settings() {
            if (settingsframe.style.display == 'none') {
                window.SendAnalyticsStep('Einstellungen geöffnet');
                settingsframe.style.display = 'block';
                setTimeout(() => {
                    settingsframe.style.opacity = '1'
                }, 10);
                var displayname = founduser.displayname;
                if (displayname) {
                    setdisplayname.value = displayname;
                }
            } else {
                window.SendAnalyticsStep('Einstellungen geschlossen');
                settingsframe.style.opacity = '0'
                setTimeout(() => {
                    settingsframe.style.display = 'none';
                }, 1000);
            }
        }

        // Funktion, um die aktuelle Uhrzeit des Nutzers zu bekommen (im lokalen Format)
        function getTageszeit() {
            const jetzt = new Date();
            const stunde = jetzt.getHours();
            const morgen = [
                { text: 'Guten Morgen', f: false },
                { text: 'Bereit für den Tag', f: true }
            ];
            const mittag = [
                { text: 'Guten Mittag', f: false },
                { text: 'Und wie läuft der Tag', f: true }
            ]
            const nachmittag = [
                { text: 'Guten Nachmittag', f: false },
                { text: 'Na, wie läuft dein Tag', f: true }
            ]
            const abend = [
                { text: 'Guten Abend', f: false },
                { text: 'Alles entspannt bei dir', f: true },
                { text: 'Lass den Tag gut ausklingen', f: false }
            ]
            const nacht = [
                { text: 'Gute Nacht', f: false },
                { text: 'Schon müde', f: true }
            ]
            let text = '';

            if (stunde >= 5 && stunde < 11) {
                const zufall = morgen[Math.floor(Math.random() * morgen.length)];
                text = zufall.text;
                if (f) f.innerText = zufall.f ? '?' : '';
            } else if (stunde >= 11 && stunde < 14) {
                const zufall = mittag[Math.floor(Math.random() * morgen.length)];
                text = zufall.text;
                if (f) f.innerText = zufall.f ? '?' : '';
            } else if (stunde >= 14 && stunde < 17) {
                const zufall = nachmittag[Math.floor(Math.random() * morgen.length)];
                text = zufall.text;
                if (f) f.innerText = zufall.f ? '?' : '';
            } else if (stunde >= 17 && stunde < 22) {
                const zufall = abend[Math.floor(Math.random() * morgen.length)];
                text = zufall.text;
                if (f) f.innerText = zufall.f ? '?' : '';
            } else {
                const zufall = nacht[Math.floor(Math.random() * morgen.length)];
                text = zufall.text;
                if (f) f.innerText = zufall.f ? '?' : '';
            }

            if (founduser.username == 'Nina13') {
                text = 'Hiiii meine kleine 😘'
                if (f) f.innerText = '';
            }
            if (begruessung) begruessung.innerText = text;
        }

        bgsetting.onmouseenter = function () {
            settingsframe.style.opacity = '0.4';
            dashboard.style.opacity = '0';
        }

        bgsetting.onmouseleave = function () {
            settingsframe.style.opacity = '1'
            dashboard.style.opacity = '1';
        }

        function changebg(color) {
            const body = document.body;

            localStorage.setItem('bg-color', color)
            nutzerdatenAendern(founduser.username, { bgcolor: color })

            // Alle verfügbaren Buttons und ihre zugehörigen Farben
            const buttons = [
                { id: 'blackbg', gradient: 'linear-gradient(-45deg, black, gray)' },
                { id: 'bluebg', gradient: 'linear-gradient(-45deg, blue, red)' },
                { id: 'greenbg', gradient: 'linear-gradient(-45deg, green, yellow)' },
                { id: 'redbg', gradient: 'linear-gradient(-45deg, red, orange)' },
                { id: 'lilabg', gradient: 'linear-gradient(-45deg, purple, blue)' },
                { id: 'bluegreenbg', gradient: 'linear-gradient(-45deg, blue, green)' },
                { id: 'greenredbg', gradient: 'linear-gradient(-45deg, green, red)' },
                { id: 'spinningbg', gradient: 'linear-gradient(-45deg, green, red)' },
                { id: 'wavebg', gradient: 'linear-gradient(-45deg, green, red)' },
                { id: 'rainbg', gradient: 'linear-gradient(-45deg, green, red)' },
                { id: 'slidebg', gradient: 'linear-gradient(-45deg, green, red)' },
            ];

            if (color == 'spinning') {
                black.style.display = 'block';
                black.style.opacity = '0';
                black.style.transition = 'opacity 1s';
                black.style.zIndex = -10;
                void black.offsetWidth;
                black.style.opacity = '1';
                buttons.forEach((button) => {
                    const element = document.getElementById(button.id);
                    if (element) {
                        if (button.id === 'spinningbg') {
                            element.classList.add('selected');
                            element.classList.remove('notselected');
                        } else {
                            element.classList.remove('selected');
                            element.classList.add('notselected');
                        }
                    }
                });
                bgiframe.addEventListener('load', function handler() {
                    bgiframe.removeEventListener('load', handler);
                    setTimeout(() => {
                        bgiframe.style.display = 'block';
                        bgiframe.style.transition = 'opacity 1s, filter 2s';
                        bgiframe.style.opacity = '1';
                        bgiframe.style.transform = 'scale(5)';
                        black.style.transition = 'opacity 1s';
                        black.style.opacity = '0';
                        black.addEventListener('transitionend', function handler2() {
                            black.style.display = 'none';
                            black.removeEventListener('transitionend', handler2);
                        });
                    }, 500);
                });
                setTimeout(() => {
                    bgiframe.setAttribute('src', 'LoadingScreen/Spinning Circle/index.html');
                }, 1000);
                return;
            } else if (color == 'wave') {
                black.style.display = 'block';
                black.style.opacity = '0';
                black.style.transition = 'opacity 1s';
                black.style.zIndex = -10;
                void black.offsetWidth;
                black.style.opacity = '1';
                buttons.forEach((button) => {
                    const element = document.getElementById(button.id);
                    if (element) {
                        if (button.id === 'wavebg') {
                            element.classList.add('selected');
                            element.classList.remove('notselected');
                        } else {
                            element.classList.remove('selected');
                            element.classList.add('notselected');
                        }
                    }
                });
                bgiframe.addEventListener('load', function handler() {
                    bgiframe.removeEventListener('load', handler);
                    setTimeout(() => {
                        bgiframe.style.display = 'block';
                        bgiframe.style.transition = 'opacity 1s, filter 2s';
                        bgiframe.style.opacity = '1';
                        bgiframe.style.transform = 'scale(1)';
                        black.style.transition = 'opacity 1s';
                        black.style.opacity = '0';
                        black.addEventListener('transitionend', function handler2() {
                            black.style.display = 'none';
                            black.removeEventListener('transitionend', handler2);
                        });
                    }, 500);
                });
                setTimeout(() => {
                    bgiframe.setAttribute('src', 'LoadingScreen/Wave/index.html');
                }, 1000);
                return;
            } else if (color == 'rain') {
                black.style.display = 'block';
                black.style.opacity = '0';
                black.style.transition = 'opacity 1s';
                black.style.zIndex = -10;
                void black.offsetWidth;
                black.style.opacity = '1';
                buttons.forEach((button) => {
                    const element = document.getElementById(button.id);
                    if (element) {
                        if (button.id === 'rainbg') {
                            element.classList.add('selected');
                            element.classList.remove('notselected');
                        } else {
                            element.classList.remove('selected');
                            element.classList.add('notselected');
                        }
                    }
                });
                bgiframe.addEventListener('load', function handler() {
                    bgiframe.removeEventListener('load', handler);
                    setTimeout(() => {
                        bgiframe.style.display = 'block';
                        bgiframe.style.transition = 'opacity 1s, filter 2s';
                        bgiframe.style.opacity = '1';
                        bgiframe.style.transform = 'scale(1)';
                        black.style.transition = 'opacity 1s';
                        black.style.opacity = '0';
                        black.addEventListener('transitionend', function handler2() {
                            black.style.display = 'none';
                            black.removeEventListener('transitionend', handler2);
                        });
                    }, 500);
                });
                setTimeout(() => {
                    bgiframe.setAttribute('src', 'LoadingScreen/Rain/index.html');
                }, 1000);
                return;
            } else if (color == 'slide') {
                black.style.display = 'block';
                black.style.opacity = '0';
                black.style.transition = 'opacity 1s';
                black.style.zIndex = -10;
                void black.offsetWidth;
                black.style.opacity = '1';
                buttons.forEach((button) => {
                    const element = document.getElementById(button.id);
                    if (element) {
                        if (button.id === 'slidebg') {
                            element.classList.add('selected');
                            element.classList.remove('notselected');
                        } else {
                            element.classList.remove('selected');
                            element.classList.add('notselected');
                        }
                    }
                });
                bgiframe.addEventListener('load', function handler() {
                    bgiframe.removeEventListener('load', handler);
                    setTimeout(() => {
                        bgiframe.style.display = 'block';
                        bgiframe.style.transition = 'opacity 1s, filter 2s';
                        bgiframe.style.opacity = '1';
                        bgiframe.style.transform = 'scale(1)';
                        black.style.transition = 'opacity 1s';
                        black.style.opacity = '0';
                        black.addEventListener('transitionend', function handler2() {
                            black.style.display = 'none';
                            black.removeEventListener('transitionend', handler2);
                        });
                    }, 500);
                });
                setTimeout(() => {
                    bgiframe.setAttribute('src', 'LoadingScreen/Sliding Diagonals/index.html');
                }, 1000);
                return;
            }

            const selectedButton = buttons.find((button) =>
                button.id.includes(color)
            );

            if (selectedButton) {
                if (color !== 'spinning' || color !== 'wave' || color !== 'rain' || color !== 'slide') {
                    bgiframe.style.opacity = '0'
                    bgiframe.setAttribute('src', ' ');
                }
                black.style.display = 'block';
                black.style.opacity = '0';
                black.style.transition = 'opacity 1s';
                void black.offsetWidth;
                black.style.opacity = '1';
                buttons.forEach((button) => {
                    const element = document.getElementById(button.id);
                    if (element) {
                        if (button.id === selectedButton.id) {
                            element.classList.add('selected');
                            element.classList.remove('notselected');
                        } else {
                            element.classList.remove('selected');
                            element.classList.add('notselected');
                        }
                    }
                });
                setTimeout(() => {
                    body.style.background = selectedButton.gradient;
                    body.style.animation = 'none';
                    body.style.backgroundSize = 'cover';
                    black.style.transition = 'opacity 1s';
                    black.style.opacity = '0';
                    black.addEventListener('transitionend', function handler() {
                        black.style.display = 'none';
                        black.removeEventListener('transitionend', handler);
                    });
                }, 300);
                localStorage.setItem('bg-color', color);
            }
        }


        function start() {
            intro.style.transition = 'opacity 1s'
            intro.style.opacity = '0'
            setTimeout(() => {
                intro.remove()
            }, 1000);
            setTimeout(() => {
                // Warten bis die Nutzer aus Supabase geladen sind
                if (users.length === 0) {
                    console.log('Warte auf Supabase-Nutzer...');
                    setTimeout(() => start(), 500);
                    return;
                }

                // Nutzer aus localStorage finden
                if (localStorage.getItem('username')) {
                    users.forEach(function (user) {
                        if (user.username === localStorage.getItem('username')) {
                            founduser = user;
                        }
                    });
                }

                window.founduser = founduser
                //Admin Funktionen
                if (founduser && founduser.username && founduser.username == 'Paluss1122') {
                    //Überschrift
                    let headerlink = document.createElement('h3')
                    headerlink.innerHTML = '<u>Admin</u>';
                    linkcontainer.appendChild(headerlink);
                    //Analytics
                    let newlink1 = document.createElement('a');
                    newlink1.setAttribute('href', 'analytics.html');
                    newlink1.innerHTML = '<span>Analytics</span>'
                    linkcontainer.appendChild(newlink1);
                    //Nutzer Verwaltung
                    let newlink2 = document.createElement('a');
                    newlink2.setAttribute('href', 'user-management.html');
                    newlink2.innerHTML = '<span>Nutzer Verwaltung</span>'
                    linkcontainer.appendChild(newlink2);
                }

                if (localStorage.getItem('allowedcookies') && !founduser.allowedcookies) {
                    window.nutzerdatenAendern(founduser.username, { 'allowedcookies': localStorage.getItem('allowedcookies') })
                }

                // Mobile Anpassung
                if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    if (loginContainer) {
                        loginContainer.style.width = '80%';
                    }
                }

                // bg-color aus Supabase in localStorage synchronisieren
                if (founduser && founduser.bgcolor && !localStorage.getItem('bg-color')) {
                    localStorage.setItem('bg-color', founduser.bgcolor);
                }
                // displayname aus Supabase in localStorage synchronisieren
                if (founduser && founduser.displayname && !localStorage.getItem('displayname')) {
                    localStorage.setItem('displayname', founduser.displayname);
                }

                // allowedcookies aus Supabase in localStorage synchronisieren
                if (founduser && founduser.allowedcookies && !localStorage.getItem('allowedcookies')) {
                    localStorage.setItem('allowedcookies', 'true');
                }

                // bg-color aus localStorage in Supabase synchronisieren (falls nicht vorhanden)
                if (localStorage.getItem('bg-color') && founduser && !founduser.bgcolor) {
                    nutzerdatenAendern(founduser.username, { bgcolor: localStorage.getItem('bg-color') });
                }

                // Vollständig eingeloggt - Dashboard anzeigen
                if (localStorage.getItem('username') &&
                    localStorage.getItem('password') &&
                    localStorage.getItem('bg-color') &&
                    localStorage.getItem('displayname') &&
                    localStorage.getItem('allowedcookies')
                ) {
                    // Dashboard direkt anzeigen
                    startp.style.display = 'none';
                    if (loginContainer) {
                        loginContainer.remove();
                    }
                    dashboard.style.display = 'block';
                    setTimeout(() => {
                        dashboard.style.opacity = '1';
                    }, 100);
                    bgiframe.style.transition = 'filter 2s';
                    bgiframe.style.filter = 'saturate(1)';
                    localStorage.setItem('showeddb', 'true');

                    getTageszeit()
                    // usname aus founduser.displayname setzen
                    if (founduser && founduser.displayname) {
                        usname.innerText = founduser.displayname;
                    }

                    changebg(founduser.bgcolor)

                    document.getElementsByClassName('settings')[0].style.display = 'block';
                    return;
                }

                // Nur Username vorhanden - Passwort eingeben
                if (localStorage.getItem('username') &&
                    !localStorage.getItem('password')
                ) {
                    startp.innerText = 'Lass uns weitermachen!';
                    setTimeout(() => {
                        startp.style.opacity = '1';
                    }, 10);
                    setTimeout(() => {
                        startp.style.transition = 'opacity 1s';
                        startp.style.opacity = '0';
                        loginContainer.style.display = 'block';
                        loginform2.style.display = 'block';
                        loginform1.style.display = 'none';
                        loginContainer.style.transition = 'opacity 1s';
                        setTimeout(() => {
                            loginContainer.style.opacity = '1';
                        }, 100);
                        bgiframe.style.filter = 'saturate(1)';
                        setTimeout(() => {
                            startp.style.display = 'none';
                        }, 1000);
                    }, 3000);
                    return;
                }

                // Username und Passwort vorhanden, aber kein bg-color
                if (localStorage.getItem('username') &&
                    localStorage.getItem('password') &&
                    !localStorage.getItem('bg-color')
                ) {
                    startp.innerText = 'Lass uns mit der Anmeldung fortfahren!';
                    setTimeout(() => {
                        startp.style.opacity = '1';
                    }, 10);
                    setTimeout(() => {
                        startp.style.transition = 'opacity 1s';
                        startp.style.opacity = '0';
                        loginContainer.style.display = 'block';
                        loginform1.style.display = 'none';
                        loginform2.style.display = 'none';
                        loginform3.style.display = 'block';
                        loginContainer.style.transition = 'opacity 1s';
                        setTimeout(() => {
                            loginContainer.style.opacity = '1';
                        }, 100);
                        bgiframe.style.filter = 'saturate(1)';
                        setTimeout(() => {
                            startp.style.display = 'none';
                        }, 1000);
                    }, 3000);
                    return;
                }

                // Username, Passwort und bg-color vorhanden, aber kein displayname
                if (localStorage.getItem('username') &&
                    localStorage.getItem('password') &&
                    localStorage.getItem('bg-color') &&
                    !localStorage.getItem('displayname')
                ) {
                    startp.innerText = 'Lass uns mit deinem personalisierten Namen weitermachen!';
                    setTimeout(() => {
                        startp.style.opacity = '1';
                    }, 10);
                    setTimeout(() => {
                        startp.style.transition = 'opacity 1s';
                        startp.style.opacity = '0';
                        loginContainer.style.display = 'block';
                        loginform1.style.display = 'none';
                        loginform2.style.display = 'none';
                        loginform3.style.display = 'none';
                        loginform4.style.display = 'block';
                        loginContainer.style.transition = 'opacity 1s';
                        setTimeout(() => {
                            loginContainer.style.opacity = '1';
                        }, 100);
                        bgiframe.style.filter = 'saturate(1)';
                        setTimeout(() => {
                            startp.style.display = 'none';
                        }, 1000);
                    }, 3000);
                    changebg(founduser.bgcolor)
                    return;
                }

                // Username, Passwort, bg-color und displayname vorhanden, aber kein allowedcookies
                if (localStorage.getItem('username') &&
                    localStorage.getItem('password') &&
                    localStorage.getItem('bg-color') &&
                    localStorage.getItem('displayname') &&
                    !localStorage.getItem('allowedcookies')
                ) {
                    startp.innerText = 'Fahren wir fort!';
                    setTimeout(() => {
                        startp.style.opacity = '1';
                    }, 10);
                    setTimeout(() => {
                        startp.style.transition = 'opacity 1s';
                        startp.style.opacity = '0';
                        loginContainer.style.display = 'block';
                        loginform1.style.display = 'none';
                        loginform2.style.display = 'none';
                        loginform3.style.display = 'none';
                        loginform4.style.display = 'none';
                        loginform5.style.display = 'block';
                        loginContainer.style.transition = 'opacity 1s';
                        setTimeout(() => {
                            loginContainer.style.opacity = '1';
                        }, 100);
                        bgiframe.style.filter = 'saturate(1)';
                        setTimeout(() => {
                            startp.style.display = 'none';
                        }, 1000);
                    }, 3000);
                    changebg(founduser.bgcolor)
                    return;
                }

                // Kein Login-Status vorhanden - alles zurücksetzen
                localStorage.clear();
                setTimeout(() => {
                    startp.style.opacity = '1';
                }, 10);
                setTimeout(() => {
                    startp.style.transition = 'opacity 1s';
                    startp.style.opacity = '0';
                    loginContainer.style.display = 'block';
                    loginContainer.style.transition = 'opacity 1s';
                    setTimeout(() => {
                        loginContainer.style.opacity = '1';
                    }, 100);
                    bgiframe.style.filter = 'saturate(1)';
                    setTimeout(() => {
                        startp.style.display = 'none';
                    }, 1000);
                }, 3000);
            }, 1000);
        }

        function info(title, text) {
            infocontainer.style.zIndex = '100';
            infocontainer.style.opacity = '1';
            infotitle.innerText = title;
            infotext.innerHTML = text;
        }

        function nousername() {
            info('Keinen Nutzername erhalten / vergessen', 'Stelle sicher, dass du Kunde bist!<br> Wenn ja, frage mich bitte nochmal nach deinem Nutzername, den ich dir dann gerne schicke!');
        }

        function nopassword() {
            info('Kein Passwort erhalten / vergessen', 'Stelle sicher, dass du Kunde bist!<br> Wenn ja, frage mich bitte nochmal nach deinem Passwort, welches ich dir dann gerne schicke!');
        }

        loginform1.onsubmit = function (event) {
            event.preventDefault();
            const usernameInput = username.value.trim();

            // Prüfen ob Nutzer aus Supabase geladen sind
            if (users.length === 0) {
                Hinweis1.style.display = 'block';
                Hinweis1.innerText = 'Fehler beim Laden der Nutzerdaten. Bitte versuche es erneut.';
                return;
            }

            users.forEach(function (user) {
                if (user.username === usernameInput) {
                    founduser = user;
                }
            });
            if (founduser !== null) {
                bgiframe.style.filter = 'saturate(0)'
                loginContainer.style.transition = 'opacity 0.5s'
                loginContainer.style.opacity = '0';
                setTimeout(() => {
                    this.style.display = 'none';
                    startp.style.display = 'block';
                    startp.innerText = 'Lass uns mit der Anmeldung fortfahren!';
                    setTimeout(() => {
                        startp.style.opacity = '1';
                    }, 10);
                    setTimeout(() => {
                        startp.style.transition = 'opacity 1s';
                        startp.style.opacity = '0';
                        loginContainer.style.display = 'block';
                        loginform1.style.display = 'none';
                        loginform2.style.display = 'block';
                        loginform3.style.display = 'none';
                        loginContainer.style.transition = 'opacity 1s';
                        setTimeout(() => {
                            loginContainer.style.opacity = '1';
                        }, 100);
                        bgiframe.style.filter = 'saturate(1)';
                        setTimeout(() => {
                            startp.style.display = 'none';
                        }, 1000);
                    }, 3000);
                }, 500);
                localStorage.setItem('username', founduser.username)
            } else {
                Hinweis1.style.display = 'block';
                Hinweis1.innerText = 'Nutzername nicht korrekt. Überprüfe die Schreibweise!';
            }
        };

        // Passwort 'absenden' Button
        loginform2.onsubmit = function (event) {
            event.preventDefault();

            // Prüfen ob Nutzer aus Supabase geladen sind
            if (users.length === 0) {
                Hinweis2.style.display = 'block';
                Hinweis2.innerText = 'Fehler beim Laden der Nutzerdaten. Bitte warte einen Moment.';
                setTimeout(() => {
                    window.location.reload()
                }, 1000);
                return
            }

            if (founduser && founduser.password == password.value) {
                bgiframe.style.filter = 'saturate(0)'
                loginContainer.style.transition = 'opacity 0.5s'
                loginContainer.style.opacity = '0';
                setTimeout(() => {
                    if (!founduser.bgcolor && !localStorage.getItem('bg-color')) {
                        bgiframe.style.transition = 'filter 2s'
                        bgiframe.style.filter = 'saturate(0)'
                        startp.style.display = 'block';
                        startp.innerText = 'Lass uns mit der Personalisierung weitermachen!';
                        setTimeout(() => {
                            startp.style.opacity = '1';
                        }, 10);
                        setTimeout(() => {
                            startp.style.transition = 'opacity 1s';
                            startp.style.opacity = '0';
                            loginContainer.style.display = 'block';
                            loginform1.style.display = 'none';
                            loginform2.style.display = 'none';
                            loginform3.style.display = 'block';
                            loginform4.style.display = 'none';
                            loginContainer.style.transition = 'opacity 1s';
                            setTimeout(() => {
                                loginContainer.style.opacity = '1';
                            }, 100);
                            bgiframe.style.filter = 'saturate(1)';
                            setTimeout(() => {
                                startp.style.display = 'none';
                            }, 1000);
                        }, 3000);
                    } else if (founduser.bgcolor && !founduser.displayname && !founduser.allowedcookies) {
                        bgiframe.style.transition = 'filter 2s'
                        bgiframe.style.filter = 'saturate(0)'
                        startp.style.display = 'block';
                        startp.innerText = 'Lass uns mit deinem personalisierten Namen weitermachen!';
                        setTimeout(() => {
                            startp.style.opacity = '1';
                        }, 10);
                        setTimeout(() => {
                            startp.style.transition = 'opacity 1s';
                            startp.style.opacity = '0';
                            loginContainer.style.display = 'block';
                            loginform1.style.display = 'none';
                            loginform2.style.display = 'none';
                            loginform3.style.display = 'none';
                            loginform4.style.display = 'block';
                            loginContainer.style.transition = 'opacity 1s';
                            setTimeout(() => {
                                loginContainer.style.opacity = '1';
                            }, 100);
                            bgiframe.style.filter = 'saturate(1)';
                            setTimeout(() => {
                                startp.style.display = 'none';
                            }, 1000);
                        }, 3000);
                    } else if (founduser.bgcolor && founduser.displayname && !founduser.allowedcookies) {
                        bgiframe.style.transition = 'filter 2s'
                        bgiframe.style.filter = 'saturate(0)'
                        startp.style.display = 'block';
                        startp.innerText = 'Fahren wir fort!';
                        setTimeout(() => {
                            startp.style.opacity = '1';
                        }, 10);
                        setTimeout(() => {
                            startp.style.transition = 'opacity 1s';
                            startp.style.opacity = '0';
                            loginContainer.style.display = 'block';
                            loginform1.style.display = 'none';
                            loginform2.style.display = 'none';
                            loginform4.style.display = 'none';
                            loginform3.style.display = 'none';
                            loginform5.style.display = 'block';
                            loginContainer.style.transition = 'opacity 1s';
                            setTimeout(() => {
                                loginContainer.style.opacity = '1';
                            }, 100);
                            bgiframe.style.filter = 'saturate(1)';
                            setTimeout(() => {
                                startp.style.display = 'none';
                            }, 1000);
                        }, 3000);
                    } else if (founduser.bgcolor && founduser.displayname && founduser.allowedcookies) {
                        bgiframe.style.transition = 'filter 2s'
                        bgiframe.style.filter = 'saturate(0)'
                        startp.style.display = 'block';
                        startp.innerText = 'Du bist nun bereit!';
                        setTimeout(() => {
                            startp.style.opacity = '1';
                        }, 10);
                        setTimeout(() => {
                            startp.style.transition = 'opacity 1s';
                            startp.style.opacity = '0';
                            loginContainer.style.display = 'none';
                            dashboard.style.display = 'block';
                            loginform1.style.display = 'none';
                            loginform2.style.display = 'none';
                            loginform3.style.display = 'none';
                            loginform4.style.display = 'none';
                            loginform5.style.display = 'none';
                            setTimeout(() => {
                                dashboard.style.opacity = '1'
                            }, 100);
                            bgiframe.style.transition = 'filter 2s'
                            bgiframe.style.filter = 'saturate(1)';
                            setTimeout(() => {
                                startp.style.display = 'none';
                            }, 1000);
                            localStorage.setItem('showeddb', true)

                            // usname aus founduser.displayname setzen
                            if (founduser && founduser.displayname) {
                                usname.innerText = founduser.displayname;
                            }
                            setTimeout(() => {
                                window.location.reload()
                            }, 2000);
                        }, 3000);
                    }
                }, 500);
                localStorage.setItem('password', founduser.password)
            } else {
                Hinweis2.style.display = 'block';
                Hinweis2.innerText = 'Passwort nicht korrekt. Überprüfe die Schreibweise!';
            }
        };

        loginform3.onsubmit = function (event) {
            event.preventDefault();
            loginContainer.style.transition = 'opacity 0.5s'
            loginContainer.style.opacity = '0';
            if (!localStorage.getItem('bg-color')) {
                changebg('spinning')
            }
            setTimeout(() => {
                if (!localStorage.getItem('displayname') && !founduser.displayname) {
                    bgiframe.style.transition = 'filter 2s'
                    bgiframe.style.filter = 'saturate(0)'
                    startp.style.display = 'block';
                    startp.innerText = 'Lass uns mit deinem personalisierten Namen weitermachen!';
                    setTimeout(() => {
                        startp.style.opacity = '1';
                    }, 10);
                    setTimeout(() => {
                        startp.style.transition = 'opacity 1s';
                        startp.style.opacity = '0';
                        loginContainer.style.display = 'block';
                        loginform1.style.display = 'none';
                        loginform2.style.display = 'none';
                        loginform3.style.display = 'none';
                        loginform4.style.display = 'block';
                        loginContainer.style.transition = 'opacity 1s';
                        setTimeout(() => {
                            loginContainer.style.opacity = '1';
                        }, 100);
                        bgiframe.style.filter = 'saturate(1)';
                        setTimeout(() => {
                            startp.style.display = 'none';
                        }, 1000);
                    }, 3000);
                } else if (localStorage.getItem('displayname') && !localStorage.getItem('allowedcookies') && !founduser.allowedcookies || founduser.displayname && !localStorage.getItem('allowedcookies') && !founduser.allowedcookies) {
                    bgiframe.style.transition = 'filter 2s'
                    bgiframe.style.filter = 'saturate(0)'
                    startp.style.display = 'block';
                    startp.innerText = 'Fahren wir fort!';
                    setTimeout(() => {
                        startp.style.opacity = '1';
                    }, 10);
                    setTimeout(() => {
                        startp.style.transition = 'opacity 1s';
                        startp.style.opacity = '0';
                        loginContainer.style.display = 'block';
                        loginform1.style.display = 'none';
                        loginform2.style.display = 'none';
                        loginform4.style.display = 'none';
                        loginform3.style.display = 'none';
                        loginform5.style.display = 'block';
                        loginContainer.style.transition = 'opacity 1s';
                        setTimeout(() => {
                            loginContainer.style.opacity = '1';
                        }, 100);
                        bgiframe.style.filter = 'saturate(1)';
                        setTimeout(() => {
                            startp.style.display = 'none';
                        }, 1000);
                    }, 3000);
                    localStorage.setItem('displayname', founduser.displayname)

                } else if (localStorage.getItem('allowedcookies') || founduser.allowedcookies) {
                    bgiframe.style.transition = 'filter 2s'
                    bgiframe.style.filter = 'saturate(0)'
                    startp.style.display = 'block';
                    startp.innerText = 'Du bist nun bereit!';
                    setTimeout(() => {
                        startp.style.opacity = '1';
                    }, 10);
                    setTimeout(() => {
                        startp.style.transition = 'opacity 1s';
                        startp.style.opacity = '0';
                        loginContainer.style.display = 'none';
                        dashboard.style.display = 'block';
                        loginform1.style.display = 'none';
                        loginform2.style.display = 'none';
                        loginform3.style.display = 'none';
                        loginform4.style.display = 'none';
                        loginform5.style.display = 'none';
                        setTimeout(() => {
                            dashboard.style.opacity = '1'
                        }, 100);
                        bgiframe.style.transition = 'filter 2s'
                        bgiframe.style.filter = 'saturate(1)';
                        setTimeout(() => {
                            startp.style.display = 'none';
                        }, 1000);
                        localStorage.setItem('showeddb', true)
                        window.location.reload()

                        // usname aus founduser.displayname setzen
                        if (founduser && founduser.displayname) {
                            usname.innerText = founduser.displayname;
                        }
                    }, 3000);
                    localStorage.setItem('allowedcookies', true)
                }
            }, 500);
        };

        loginform4.onsubmit = function (event) {
            event.preventDefault();
            loginContainer.style.transition = 'opacity 0.5s'
            loginContainer.style.opacity = '0';
            setTimeout(() => {
                bgiframe.style.transition = 'filter 2s'
                bgiframe.style.filter = 'saturate(0)'
                startp.style.display = 'block';
                startp.innerText = 'Fahren wir fort!';
                setTimeout(() => {
                    startp.style.opacity = '1';
                }, 10);
                setTimeout(() => {
                    startp.style.transition = 'opacity 1s';
                    startp.style.opacity = '0';
                    loginContainer.style.display = 'block';
                    loginform1.style.display = 'none';
                    loginform2.style.display = 'none';
                    loginform4.style.display = 'none';
                    loginform5.style.display = 'block';
                    loginContainer.style.transition = 'opacity 1s';
                    setTimeout(() => {
                        loginContainer.style.opacity = '1';
                    }, 100);
                    bgiframe.style.filter = 'saturate(1)';
                    setTimeout(() => {
                        startp.style.display = 'none';
                    }, 1000);
                }, 3000);
            }, 500);
            localStorage.setItem('displayname', displayname.value)
            nutzerdatenAendern(founduser.username, { displayname: displayname.value })
        };

        loginform5.onsubmit = function (event) {
            event.preventDefault();
            if (localStorage.getItem('displayname')) {
                usname.innerText = founduser.displayname
            }
            localStorage.setItem('allowedcookies', true);
            nutzerdatenAendern(founduser.username, { allowedcookies: true })
            loginContainer.style.transition = 'opacity 0.5s'
            loginContainer.style.opacity = '0';
            setTimeout(() => {
                bgiframe.style.transition = 'filter 2s'
                bgiframe.style.filter = 'saturate(0)'
                startp.style.display = 'block';
                startp.innerText = 'Du bist nun bereit!';
                setTimeout(() => {
                    startp.style.opacity = '1';
                }, 10);
                setTimeout(() => {
                    startp.style.transition = 'opacity 1s';
                    startp.style.opacity = '0';
                    loginContainer.style.display = 'none';
                    dashboard.style.display = 'block';
                    loginform1.style.display = 'none';
                    loginform2.style.display = 'none';
                    loginform3.style.display = 'none';
                    loginform4.style.display = 'none';
                    loginform5.style.display = 'none';
                    setTimeout(() => {
                        dashboard.style.opacity = '1'
                    }, 100);
                    bgiframe.style.transition = 'filter 2s'
                    bgiframe.style.filter = 'saturate(1)';
                    setTimeout(() => {
                        startp.style.display = 'none';
                    }, 1000);
                    localStorage.setItem('showeddb', true)

                    // usname aus founduser.displayname setzen
                    if (founduser && founduser.displayname) {
                        usname.innerText = founduser.displayname;
                    }
                }, 3000);
            }, 500);
            window.location.reload()
        };

        setdisplayname.onsubmit = function (e) {
            e.preventDefault();
            nutzerdatenAendern(founduser.username, { displayname: setdisplayname.value });
            Hinweis3.innerText = 'Name erfolgreich geändert!'
        }

    </script>
</body>

</html>